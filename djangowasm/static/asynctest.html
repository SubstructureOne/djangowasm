<html lang="en">
<head>
    <title>Loading...</title>
    <script src="https://cdn.jsdelivr.net/pyodide/v0.21.3/full/pyodide.js"></script>
    <script>
        async function main() {
            let pyodide = await loadPyodide()
            await pyodide.loadPackage('micropip')
            // const micropip = pyodide.pyimport('micropip')
            // await micropip.install('wasmsockets==0.1.1')
            await pyodide.loadPackage("https://files.pythonhosted.org/packages/e1/54/4ee8eca2097c0e1257f833197f787eeb29519f0fcd1423487d3e46dc82e3/wasmsockets-0.1.2-py3-none-any.whl")
            await pyodide.runPythonAsync(`
                import wasmsockets.client
                import js
                import pyodide.ffi
                import asyncio

                socket = wasmsockets.client.connect('ws://localhost:8765')
                def syncfunction():
                    msg = "hello"
                    loop = asyncio.new_event_loop()
                    loop.run_until_complete(socket.send(msg))
                    result = loop.run_until_complete(socket.recv())

                syncfunction()
            `)
        }
        main()
    </script>
</head>

<body>
<h1>Check Console</h1>
</body>
</html>
